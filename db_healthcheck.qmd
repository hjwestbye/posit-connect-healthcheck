---
title: "DB Healthcheck (Postgres)"
format: html
execute:
  echo: false
  warning: false
  message: false
---



```{r}
library(DBI)
library(RPostgres)

# =========================
# Supabase connection (DIRECT)
# =========================
con <- DBI::dbConnect(
  RPostgres::Postgres(),
  host     = "db.wtkzwwhvwdtsusourfjh.supabase.co",
  port     = 5432,
  dbname   = "postgres",
  user     = "postgres",
  password = "slippmeginn",
  sslmode  = "require"
)

on.exit(try(DBI::dbDisconnect(con), silent = TRUE), add = TRUE)

cat("Connected OK\n")

# =========================
# Minimal sanity checks
# =========================
print(DBI::dbGetQuery(
  con,
  "SELECT
     1        AS ok,
     now()    AS server_time,
     current_user AS db_user,
     inet_server_addr() AS server_addr;"
))

# =========================
# Minimal write/read test
# =========================
DBI::dbExecute(con, "
  CREATE TABLE IF NOT EXISTS public.healthcheck (
    id BIGSERIAL PRIMARY KEY,
    ts TIMESTAMPTZ NOT NULL DEFAULT now()
  );
")

DBI::dbExecute(con, "INSERT INTO public.healthcheck DEFAULT VALUES;")

print(DBI::dbGetQuery(con, "
  SELECT *
  FROM public.healthcheck
  ORDER BY id DESC
  LIMIT 5;
"))


```


